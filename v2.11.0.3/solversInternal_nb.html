

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tweaking the (non-) linear solvers &mdash; Tutorial for version 2.11-git</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Alternative Solvers (e.g. Scipy, Petsc)" href="solversExternal_nb.html" />
    <link rel="prev" title="More General Boundary Conditions" href="boundary_nb.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/dune-python-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
     <span class="caption-text">
     <li><u><a href="genindex.html" style="color:white">Keyword list</a></u></li>
     <li><u><a href="changelog210.html" style="color:white">Most recent changes</a></u></li>
     <li><u><a href="versions.html" style="color:white">Other versions</a></u></li>
     </span>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">An Overview of this Document</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Teasers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="furtherexamples.html">Main Gallery</a><ul>
<li class="toctree-l2"><a class="reference internal" href="discontinuousgalerkin_nb.html">Discontinuous Galerkin Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="discontinuousgalerkin_nb.html#Advection-Diffusion:-Discontinuous-Galerkin-Method-with-Upwinding">Advection-Diffusion: Discontinuous Galerkin Method with Upwinding</a></li>
<li class="toctree-l3"><a class="reference internal" href="discontinuousgalerkin_nb.html#A-linear-transport-problem">A linear transport problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="elasticity_nb.html">Linear Elasticity: a deformed beam</a></li>
<li class="toctree-l2"><a class="reference internal" href="spiral_nb.html">Time Dependent Reaction Diffuison: spiral wave</a></li>
<li class="toctree-l2"><a class="reference internal" href="wave_nb.html">Wave Equation: double slit domain (using mass lumping)</a></li>
<li class="toctree-l2"><a class="reference internal" href="stokes.html">Saddle point solver for the stationary Stokes problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="monolithicStokes_nb.html">Monolithic solver (Lagrange and DG formulation)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="monolithicStokes_nb.html#Taylor-Hood-formulation">Taylor-Hood formulation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="monolithicStokes_nb.html#Bercovier-Engelmann-Testcase">Bercovier-Engelmann Testcase</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="monolithicStokes_nb.html#DG-formulation">DG formulation</a><ul>
<li class="toctree-l5"><a class="reference internal" href="monolithicStokes_nb.html#id3">Bercovier-Engelmann Testcase</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="monolithicStokes_nb.html#Convergence-rate-check">Convergence rate check</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="fieldsplitStokes_nb.html">Stokes problem with fieldsplit preconditioner (PETSc)</a></li>
<li class="toctree-l3"><a class="reference internal" href="uzawa-scipy_nb.html">(Quasi) Stokes equations (Scipy based Uzawa scheme)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cylinder_nb.html">Navier-Stokes: flow around a cylinder</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixed_poisson_nb.html">Mixed method for the Poisson equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="evalues_laplace_nb.html">Eigenvalue problems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="evalues_laplace_nb.html#Eigenvalues-of-the-Neumann-Laplacian">Eigenvalues of the Neumann Laplacian</a></li>
<li class="toctree-l3"><a class="reference internal" href="evalues_laplace_nb.html#Dirichlet-Eigenvalue-problem">Dirichlet Eigenvalue problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="biharmonic_IPC0_nb.html">Biharmonic problem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="biharmonic_IPC0_nb.html#Implementation">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="biharmonic_IPC0_nb.html#Simply-supported-boundary-conditions">Simply supported boundary conditions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="crystal_nb.html">Adaptive phase field: crystal growth model</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcf_nb.html">Moving surface grid: flow under mean curvature</a></li>
<li class="toctree-l2"><a class="reference internal" href="laplace-dwr_nb.html">Dual Weighted Reisdual Estimate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="furtherexamples.html#extension-modules">Extension Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="furtherexamples.html#discontinuous-galerkin-methods-with-dune-fem-dg">Discontinuous Galerkin Methods with DUNE-FEM-DG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="euler_nb.html">Euler System of Gas Dynamics</a></li>
<li class="toctree-l3"><a class="reference internal" href="chemical_nb.html">An Advection-Diffusion-Reaction System: Chemical Reaction Problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="furtherexamples.html#virtual-element-methods-with-dune-vem">Virtual Element Methods with DUNE-VEM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="vemdemo_nb.html">Elliptic Problems</a></li>
<li class="toctree-l3"><a class="reference internal" href="vemdemo_nb.html#Nonlinear-Elliptic-Problem">Nonlinear Elliptic Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="vemdemo_nb.html#Linear-Elasticity">Linear Elasticity</a></li>
<li class="toctree-l3"><a class="reference internal" href="vemdemo_nb.html#Fourth-order-problem">Fourth order problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="chimpl_nb.html">Cahn-Hilliard</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">From PyPi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#additional-external-packages">Additional external packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#testing-the-installation">Testing the installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hints-for-windows">Hints for Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#from-source">From Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#building-the-required-dune-modules">Building the Required Dune Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#troubleshooting">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dune-fempy_nb.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#A-Laplace-problem">A Laplace problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#Laplace-equation-with-Dirichlet-boundary-conditions">Laplace equation with Dirichlet boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#A-non-linear-elliptic-problem">A non-linear elliptic problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#Using-Constant-parameters-and-grid-functions-in-PDEs">Using <code class="docutils literal notranslate"><span class="pre">Constant</span></code> parameters and grid functions in PDEs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts_nb.html">General Concepts (with a time dependent problem)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Setting-up-the-Grid">Setting up the Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Grid-Functions">Grid Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Discrete-Spaces">Discrete Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Discrete-Functions">Discrete Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Operators-and-Schemes">Operators and Schemes</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#A-Nonlinear-Time-Dependent-Problem">A Nonlinear Time Dependent Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Listing-Available-Dune-Components">Listing Available Dune Components</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Next Steps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="boundary_nb.html">More General Boundary Conditions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Dirichlet-boundary-conditions">Dirichlet boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Accessing-the-Dirichlet-degrees-of-freedom">Accessing the Dirichlet degrees of freedom</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Neumann-and-Robin-boundary-conditions">Neumann and Robin boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Using-boundary-ids-(and-some-more-complex-examples)">Using boundary ids (and some more complex examples)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="boundary_nb.html#Cartesian-boundary-ids">Cartesian boundary ids</a></li>
<li class="toctree-l3"><a class="reference internal" href="boundary_nb.html#Mixing-different-types-of-boundary-conditions">Mixing different types of boundary conditions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tweaking the (non-) linear solvers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Python-sided-Newton-solver">Python sided Newton solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Handling-Dirichlet-boundary-conditions">Handling Dirichlet boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Other-internal-solvers-(petsc)">Other internal solvers (petsc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Other-internal-solvers-(istl)">Other internal solvers (istl)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Parameters-for-fine-tuning-the-internal-solvers">Parameters for fine-tuning the internal solvers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Available-solvers-and-parameters">Available solvers and parameters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="solversExternal_nb.html">Alternative Solvers (e.g. Scipy, Petsc)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="solversExternal_nb.html#Accessing-underlying-data-structures">Accessing underlying data structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="solversExternal_nb.html#Defining-discrete-function-with-given-external-dof-vector">Defining discrete function with given external dof vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="solversExternal_nb.html#Using-Scipy">Using Scipy</a></li>
<li class="toctree-l2"><a class="reference internal" href="solversExternal_nb.html#Using-scikit-umfpack">Using scikit-umfpack</a></li>
<li class="toctree-l2"><a class="reference internal" href="solversExternal_nb.html#Using-PETSc4Py">Using PETSc4Py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="othergrids_nb.html">Examples of grid construction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Example-using-the-Dune-Grid-Format-(DGF)">Example using the Dune Grid Format (DGF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#3D-example-(using-PyGmsh)">3D example (using PyGmsh)</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Converting-gmsh-to-DGF">Converting gmsh to DGF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="othergrids_nb.html#Attaching-boundary-ids-to-a-grid-constructed-with-gmsh-using-DGF">Attaching boundary ids to a grid constructed with gmsh using DGF</a></li>
<li class="toctree-l3"><a class="reference internal" href="othergrids_nb.html#Visualizing-Boundary-Ids">Visualizing Boundary Ids</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Using-meshio-to-read-a-gmsh-file">Using <code class="docutils literal notranslate"><span class="pre">meshio</span></code> to read a gmsh file</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#1D-example">1D example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parallelization_nb.html">Parallelization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parallelization_nb.html#OpenMP">OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallelization_nb.html#MPI">MPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parallelization_nb.html#Load-balancing">Load balancing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backuprestore_nb.html">Backup and restore (pickling)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="backuprestore_nb.html#Pickling">Pickling</a></li>
<li class="toctree-l2"><a class="reference internal" href="backuprestore_nb.html#A-Chekpointer-class">A Chekpointer class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="corepy.html">Using the Full Grid Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Dense-Vectors-and-the-Geometry-Classes">Dense Vectors and the Geometry Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Grid-Construction-and-Basic-Interface">Grid Construction and Basic Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Structured-grids">Structured grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Unstructured-grids">Unstructured grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Local-grid-adaptivity">Local grid adaptivity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dune-corepy_nb.html#Basic-information-and-iterators">Basic information and iterators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Using-grid-functions">Using grid functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Importing-user-defined-C++-code">Importing user defined C++ code</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Attaching-Data-to-the-Grid">Attaching Data to the Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Output-of-Grid-and-Visualization-of-Data">Output of Grid and Visualization of Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Matplotlib">Matplotlib</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Paraview-(vtu/vtk-files)">Paraview (vtu/vtk files)</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Mayavi">Mayavi</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Low-level-output">Low level output</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gridviews_and_adaptivity.html">Grid views and adaptivity</a><ul>
<li class="toctree-l2"><a class="reference internal" href="gridviews_and_adaptivity.html#overview-and-some-basic-grid-views-level-and-filtered">Overview and some basic grid views (level and filtered)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="levelgridview_nb.html">LevelGridView examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="filteredgridview_nb.html">FilteredGridView examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gridviews_and_adaptivity.html#dynamic-local-grid-refinement-and-coarsening">Dynamic Local Grid Refinement and Coarsening</a><ul>
<li class="toctree-l3"><a class="reference internal" href="laplace-adaptive_nb.html">Re-entrant Corner Problem</a></li>
<li class="toctree-l3"><a class="reference internal" href="crystal_nb.html">Adaptive phase field: crystal growth model</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gridviews_and_adaptivity.html#overview-on-adaptivity-for-spaces-p-adaptation">Overview on adaptivity for spaces (p-adaptation)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="twophaseflow_descr.html">HP adaptive DG scheme for twophase flow problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html">Problem Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Defining-the-model">Defining the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Time-discretization">Time discretization</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Stabilization-(Limiter)">Stabilization (Limiter)</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Iterative-schemes-(iterative-or-impes-iterative)">Iterative schemes (iterative or impes-iterative)</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#HP-Adpativity">HP Adpativity</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-grid-adaptivity-(h).">Marker for grid adaptivity (h).</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-space-adaptivity-(p)">Marker for space adaptivity (p)</a></li>
<li class="toctree-l4"><a class="reference internal" href="twophaseflow_nb.html#Main-program">Main program</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="gridviews_and_adaptivity.html#evolving-domains">Evolving Domains</a><ul>
<li class="toctree-l3"><a class="reference internal" href="mcf_nb.html">Moving surface grid: flow under mean curvature</a></li>
<li class="toctree-l3"><a class="reference internal" href="elasticity_nb.html">Linear Elasticity: a deformed beam</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">Using C++ Code Snippets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cppfunctions_nb.html">C++ Based Grid Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="lineplot_nb.html">Sampling the Solution over a Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcf-algorithm_nb.html">Mean Curvature Flow (revisited)</a></li>
<li class="toctree-l2"><a class="reference internal" href="laplace-dwr-algorithm_nb.html">Dual Weighted Reisdual Estimate (revisited)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scheme_api.html">API for schemes and operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#abstract-concepts">Abstract concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-without-dbc">Operator without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-with-dbc">Operator with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-without-dbc">Scheme without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-with-dbc">Scheme with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#additional">Additional</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#unclear">Unclear</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other Projects using Dune-Fem</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="twophaseflow_descr.html">HP adaptive DG scheme for twophase flow problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Defining-the-model">Defining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Time-discretization">Time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Stabilization-(Limiter)">Stabilization (Limiter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Iterative-schemes-(iterative-or-impes-iterative)">Iterative schemes (iterative or impes-iterative)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#HP-Adpativity">HP Adpativity</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-grid-adaptivity-(h).">Marker for grid adaptivity (h).</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-space-adaptivity-(p)">Marker for space adaptivity (p)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Main-program">Main program</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mmesh_descr.html">Mixed-dimensional PDEs: the Dune-MMesh module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mmesh_nb.html">Dune-MMesh: Solving a Mixed-dimensional PDE</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="landlab_descr.html">Components for the Landlab software package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="overview_of_advection_solver_nb.html">Linear Advection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="overview_of_advection_solver_nb.html#Advection-of-a-Gaussian-%22bump%22-in-2d">Advection of a Gaussian “bump” in 2d</a><ul>
<li class="toctree-l4"><a class="reference internal" href="overview_of_advection_solver_nb.html#Raster-grid-with-advection-to-the-east">Raster grid with advection to the east</a><ul>
<li class="toctree-l5"><a class="reference internal" href="overview_of_advection_solver_nb.html#Instantiate-component">Instantiate component</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="overview_of_advection_solver_nb.html#Raster-grid-with-advection-to-the-north">Raster grid with advection to the north</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview_of_advection_solver_nb.html#Raster-grid-with-advection-to-the-southwest">Raster grid with advection to the southwest</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview_of_advection_solver_nb.html#Raster-grid-with-a-non-uniform-advection-field">Raster grid with a non-uniform advection field</a></li>
<li class="toctree-l4"><a class="reference internal" href="overview_of_advection_solver_nb.html#Case-of-divergent-velocity">Case of divergent velocity</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="overview_of_advection_solver_nb.html#A-rotating-cone">A rotating cone</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html">A Linear Diffusion Overland Flow Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#Overview">Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#Model">Model</a><ul>
<li class="toctree-l5"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#Flow-direction,-depth,-and-velocity">Flow direction, depth, and velocity</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#Numerical-Methods">Numerical Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#The-component">The component</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#Example-2:-overland-flow-on-a-DEM">Example 2: overland flow on a DEM</a></li>
<li class="toctree-l3"><a class="reference internal" href="linear_diffusion_overland_flow_dune_nb.html#References">References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ddfem_descr.html">DDFEM: Diffuse Domain Python package</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information and Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing this project</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Information for C++ Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developers.html#remove-and-rebuild-existing-modules">Remove and rebuild existing modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#using-a-debugger">Using a debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#list-of-build-specific-environment-variables">List of build specific environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributions.html">Contributing to this tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributions.html#how-to-showcase-your-own-work">How to showcase your own work</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional.html">Additional Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog290.html">Since 2.9 release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#general-changes">General changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#updating-to-newer-version-of-ufl">Updating to newer version of UFL</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#new-clone-method-on-spaces">New <cite>clone</cite> method on spaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#dirichlet-bcs-for-operators-with-different-range-domain-space">Dirichlet BCs for operators with different range/domain space</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#changes-to-solver-parameter-keys">Changes to solver parameter keys</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#added-a-solve-method-to-the-linearization-of-schemes">Added a <code class="docutils literal notranslate"><span class="pre">solve</span></code> method to the linearization of <code class="docutils literal notranslate"><span class="pre">schemes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#updated-dune-fem-scheme-linearized">Updated <code class="docutils literal notranslate"><span class="pre">dune.fem.scheme.linearized</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#add-operator-len-to-spaces">Add operator <code class="docutils literal notranslate"><span class="pre">__len__</span></code> to spaces.</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#add-dirichletindices-method-to-operators-and-schemes">Add <code class="docutils literal notranslate"><span class="pre">DirichletIndices</span></code> method to operators and schemes</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#extension-of-the-jacobian-method-on-schemes-and-operators">Extension of the <code class="docutils literal notranslate"><span class="pre">jacobian</span></code> method on schemes and operators</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#set-non-default-quadratures-in-quadrature-rules">Set non default quadratures in quadrature rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#assembly-function">Assembly function</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#improved-pickling-support">Improved Pickling support</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#paraview-reader">Paraview Reader</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#sampler-along-boundary">Sampler along Boundary</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#point-sampler-returning-entity-local-coordinate-for-given-global-coordinate">Point sampler returning (entity,local coordinate) for given global coordinate</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#improved-boundary-indexing-in-ufl-forms-for-boundary-integrals-and-dirichlet-conditions">Improved Boundary Indexing in UFL Forms (for boundary integrals and Dirichlet conditions)</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#eisenstatwalker-in-newton-method">Eisenstatwalker in Newton method</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#storage-setup-in-scheme">Storage setup in scheme</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#methods-on-space-to-return-local-mapper-and-for-evaluating-basis-functions">Methods on space to return local mapper and for evaluating basis functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#logging-of-parameter-values">Logging of parameter values</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-the-rhs-argument-for-scheme-solve">Deprecation of the <code class="docutils literal notranslate"><span class="pre">rhs</span></code> argument for <code class="docutils literal notranslate"><span class="pre">scheme.solve</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-function-integrate">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.function.integrate</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-function-uflfunction-and-dune-fem-function-cppfunction">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.function.uflFunction</span></code> and <code class="docutils literal notranslate"><span class="pre">dune.fem.function.cppFunction</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-dune-ufl-expression2gf">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.ufl.expression2GF</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-operator-linear">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.operator.linear</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-space-combinedspace">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.space.combinedSpace</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#dune-vem">DUNE-VEM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#dirichlet-constraints-for-conforming-c-1-space">Dirichlet constraints for conforming $C^1$ space</a></li>
<li class="toctree-l4"><a class="reference internal" href="changelog290.html#intersection-integrals-now-use-the-edge-projections">Intersection integrals now use the edge projections</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="changelog210.html">Since 2.10 release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog210.html#breaking-changes">Breaking changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog210.html#general-changes">General changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog210.html#bugfixes">Bugfixes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="changelog210.html#pickling-of-discrete-functions">Pickling of discrete functions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inforesources.html">Keyword index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gmsh2dgf_nb.html">Converting gmsh to DGF</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurmbatchscript.html">Slurm batch script</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheme_api.html">API for schemes and operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#abstract-concepts">Abstract concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-without-dbc">Operator without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-with-dbc">Operator with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-without-dbc">Scheme without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-with-dbc">Scheme with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#additional">Additional</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#unclear">Unclear</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">List of things that need doing…</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DUNE-FEM Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="nextsteps.html">Next steps</a></li>
      <li class="breadcrumb-item active">Tweaking the (non-) linear solvers</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="boundary_nb.html" class="btn btn-neutral float-left" title="More General Boundary Conditions" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="solversExternal_nb.html" class="btn btn-neutral float-right" title="Alternative Solvers (e.g. Scipy, Petsc)" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
This document is part of the dune-fem tutorial
<a href="https://doi.org/10.5281/zenodo.3706994"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3706994.svg" alt="DOI"></a><div class="line-block">
<div class="line">Download <em>solversInternal</em> as <a class="reference download internal" download="" href="_downloads/3385c1e627e7349eab78727455fc0e93/solversInternal_nb.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">notebook</span> <span class="pre">(_nb.ipynb)</span></code></a> or as <a class="reference download internal" download="" href="_downloads/d01f5757879fef2679cefb65d469f266/solversInternal.py"><code class="xref download docutils literal notranslate"><span class="pre">Python</span> <span class="pre">script</span> <span class="pre">(.py)</span></code></a></div>
</div>
</div>
<section id="Tweaking-the-(non-)-linear-solvers">
<h1>Tweaking the (non-) linear solvers<a class="headerlink" href="#Tweaking-the-(non-)-linear-solvers" title="Link to this heading"></a></h1>
<p>Here we look at how to tweak the internal linear and nonlinear solvers. The <code class="docutils literal notranslate"><span class="pre">solve</span></code> method on the <code class="docutils literal notranslate"><span class="pre">schemes</span></code> uses a Newton method to solve the (non)linear PDE model. Parameters set during the construction of a <code class="docutils literal notranslate"><span class="pre">scheme</span></code> can be used to customize the Newton solver and the underlying solver for the linear problem in each step, i.e., setting line-search parameters or preconditioners. A number of linear solvers and some simple preconditioners are directly available and others can be used through
additional software packages. This is done by changing the linear algebra backend (e.g. using <code class="docutils literal notranslate"><span class="pre">petsc</span></code>) by using the <code class="docutils literal notranslate"><span class="pre">storage</span></code> parameter during construction of the discrete space. The simplicity of the default backend (<code class="docutils literal notranslate"><span class="pre">numpy</span></code>) allows to extract the underlying data structures to use with Numpy/Scipy on the python side. A degrees of freedom vector (dof vector) can be retrieved as <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code> from a discrete function with this default storage by using the <code class="docutils literal notranslate"><span class="pre">as_numpy</span></code> attribute on an
instance of a discrete function. Similar attributes are available for the other storages, i.e., <code class="docutils literal notranslate"><span class="pre">as_istl,as_petsc</span></code>. The same attributes are also available to retrieve the underlying matrix structures on linear operators/schemes. A short description on the other storages with examples using the internal bindings for these packages follows at the end of this section. We will discuss how to use these attributes to implement (parts of) the solution algorithm on the Python side using <code class="docutils literal notranslate"><span class="pre">Scipy</span></code> or
<code class="docutils literal notranslate"><span class="pre">PETSc4py</span></code> <a class="reference internal" href="solversExternal_nb.html"><span class="doc">will follow</span></a>.</p>
<p>We will mostly revisit the nonlinear problem studied at the end of the section on <a class="reference internal" href="dune-fempy_nb.html#A-non-linear-elliptic-problem"><span class="std std-ref">non-linear elliptic problems</span></a> in the introduction - using a prescribed forcing to obtain the exact solution <span class="math">\begin{align*}
u(x,y) = \left(\frac{1}{2}(x^2 + y^2) - \frac{1}{3}(x^3 - y^3)\right) + 1
\end{align*}</span> The following code was described in the <a class="reference internal" href="dune-fempy_nb.html"><span class="doc">introduction</span></a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">dune.grid</span><span class="w"> </span><span class="kn">import</span> <span class="n">structuredGrid</span> <span class="k">as</span> <span class="n">leafGridView</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dune.fem.space</span><span class="w"> </span><span class="kn">import</span> <span class="n">lagrange</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dune.fem</span><span class="w"> </span><span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ufl</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestFunction</span><span class="p">,</span> <span class="n">TrialFunction</span><span class="p">,</span> <span class="n">SpatialCoordinate</span><span class="p">,</span> <span class="n">FacetNormal</span><span class="p">,</span> \
                <span class="n">dx</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">div</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">conditional</span>

<span class="n">gridView</span> <span class="o">=</span> <span class="n">leafGridView</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">gridView</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">u_h</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;u_h&#39;</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="p">(</span> <span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">space</span><span class="p">),</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">space</span><span class="p">),</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">space</span><span class="p">),</span> <span class="n">FacetNormal</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="p">)</span>
<span class="n">exact</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">a</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">u</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="o">*</span><span class="n">v</span> <span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">bf</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">div</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">exact</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">exact</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">exact</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">bg</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">exact</span><span class="p">),</span><span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">ds</span>

<span class="c1"># simple function to show the result of a simulation</span>
<span class="k">def</span><span class="w"> </span><span class="nf">printResult</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="n">info</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">method</span><span class="p">,</span><span class="s2">&quot;L^2, H^1 error:&quot;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:0.5e}</span><span class="s1">, </span><span class="si">{:0.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                 <span class="o">*</span><span class="p">[</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">integrate</span><span class="p">([</span><span class="n">error</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">error</span><span class="p">),</span><span class="n">grad</span><span class="p">(</span><span class="n">error</span><span class="p">))])</span> <span class="p">]),</span>
          <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot;solver info=&quot;</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>When creating a scheme, it is possible to set the linear solver as well as parameters for the internal Newton solver and the linear solver (e.g. for preconditioning). See a list of available solvers and preconditioning methods at <a class="reference internal" href="#Available-solvers-and-parameters"><span class="std std-ref">the end of this section</span></a>. The default solver is a <code class="docutils literal notranslate"><span class="pre">gmres</span></code> method but since this problem is symmetric a <code class="docutils literal notranslate"><span class="pre">cg</span></code> solver is more efficient. In addition we will use a Jacobi preconditioner and set the tolerance for the Newton method
to <span class="math notranslate nohighlight">\(10^{-8}\)</span>. In addition we also use the <code class="docutils literal notranslate"><span class="pre">Eisenstat-Walker</span></code> strategy for choosing the tolerance for the linear solver - this requires the error measure to be <code class="docutils literal notranslate"><span class="pre">residual</span> <span class="pre">reduction</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dune.fem.scheme</span><span class="w"> </span><span class="kn">import</span> <span class="n">galerkin</span>
<span class="n">scheme</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">bf</span><span class="o">+</span><span class="n">bg</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">,</span>
                  <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;linear.preconditioning.method&quot;</span><span class="p">:</span><span class="s2">&quot;jacobi&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;nonlinear.forcing&quot;</span><span class="p">:</span><span class="s2">&quot;eisenstatwalker&quot;</span><span class="p">,</span>
                              <span class="c1"># this is the default for this forcing</span>
                              <span class="s2">&quot;linear.errormeasure&quot;</span><span class="p">:</span><span class="s2">&quot;residualreduction&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;nonlinear.tolerance&quot;</span><span class="p">:</span><span class="mf">1e-7</span><span class="p">},</span>
                 <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>we use Krylov methods like <code class="docutils literal notranslate"><span class="pre">cg</span></code> and <code class="docutils literal notranslate"><span class="pre">gmres</span></code> in this section to solve the linear problems. We also provide bindings for direct solvers from the <code class="docutils literal notranslate"><span class="pre">suitesparse</span></code> package, e.g., <code class="docutils literal notranslate"><span class="pre">umfpack</span></code> if installed. For this use <code class="docutils literal notranslate"><span class="pre">solver=[&quot;suitesparse&quot;,&quot;umfpack&quot;]</span></code> when constructing the scheme.</p>
</div>
<p>We can simply use the <code class="docutils literal notranslate"><span class="pre">galerkin</span></code> scheme instance to compute the solution as shown previously in <a class="reference internal" href="dune-fempy_nb.html"><span class="doc">the introduction section</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>               <span class="c1"># start with the boundary conditions at the top</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Default&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
<span class="n">u_h</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Default L^2, H^1 error: 1.17598e-06, 1.83002e-04
         solver info= {&#39;converged&#39;: True, &#39;iterations&#39;: 5, &#39;linear_iterations&#39;: 289, &#39;timing&#39;: [0.077352758, 0.023532723, 0.053820034999999995]}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/solversInternal_nb_5_1.jpg" src="_images/solversInternal_nb_5_1.jpg" />
</div>
</div>
<section id="Python-sided-Newton-solver">
<h2>Python sided Newton solver<a class="headerlink" href="#Python-sided-Newton-solver" title="Link to this heading"></a></h2>
<p>We can also only use the internal linear solvers and write the Newton method in Python - here is a very simple version of that. The central new method is <code class="docutils literal notranslate"><span class="pre">linear</span></code> available on the scheme that returns a linear <code class="docutils literal notranslate"><span class="pre">scheme</span></code> which represents the Jacobian of the model around a given grid function <code class="docutils literal notranslate"><span class="pre">ubar</span></code>. Much more details on the methods used are given <a class="reference internal" href="solversExternal_nb.html"><span class="doc">in the next section</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">Scheme1</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">u0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">ubar</span><span class="o">=</span><span class="n">u0</span><span class="p">)</span> <span class="c1"># obtain a linear operator for the Newton method</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="c1"># create a copy of target for the residual</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;residual&quot;</span><span class="p">)</span>
        <span class="n">dh</span>  <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;direction&quot;</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">linIter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># res = S[u]</span>
            <span class="c1">#     = u - g on boundary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
            <span class="n">absF</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">scalarProductDofs</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">absF</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span> <span class="c1"># this is the same tolerance we set above for the built-in Newton solver</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="p">)</span>  <span class="c1"># assemble the linearization</span>
            <span class="c1"># dh = DS[u]^{-1}S[u]</span>
            <span class="c1">#    = u - g on boundary</span>
            <span class="n">dh</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jacobian</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">dh</span><span class="p">,</span><span class="n">rightHandSide</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
            <span class="n">linIter</span> <span class="o">+=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;linear_iterations&quot;</span><span class="p">]</span>
            <span class="c1"># unew = u - DS[u]^{-1}S[u]</span>
            <span class="c1">#      = u - (u-g) = g on boundary</span>
            <span class="n">target</span> <span class="o">-=</span> <span class="n">dh</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;iterations&quot;</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;linear_iterations&quot;</span><span class="p">:</span><span class="n">linIter</span><span class="p">}</span>

<span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                        <span class="c1"># start with the boundary conditions at the top</span>
<span class="n">scheme_cls</span> <span class="o">=</span> <span class="n">Scheme1</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span><span class="n">u0</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme_cls</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Newton 1&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Newton 1 L^2, H^1 error: 1.17597e-06, 1.83002e-04
         solver info= {&#39;iterations&#39;: 4, &#39;linear_iterations&#39;: 619}
</pre></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The iterative linear solvers use the provided target discrete function as initial guess for the iteration - so here we are starting with <code class="docutils literal notranslate"><span class="pre">0</span></code> in each step of the Newton method.</p>
</div>
<p>A second version using a linearization of the non-linear problem including an affine shift, i.e., the first two terms in the Taylor expansion around a given <span class="math notranslate nohighlight">\(\bar{u}\)</span>:</p>
<div class="math notranslate nohighlight">
\[L[u] = DS[\bar{u}](u-\bar{u}) + S[\bar{u}]\]</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dune.fem.scheme</span><span class="w"> </span><span class="kn">import</span> <span class="n">linearized</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Scheme2</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scheme</span><span class="p">,</span> <span class="n">u0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheme</span> <span class="o">=</span> <span class="n">scheme</span>
        <span class="c1"># let&#39;s use a `gmres` solver for demonstration purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">linearized</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span> <span class="n">ubar</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span>
                      <span class="n">parameters</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;gmres&quot;</span><span class="p">,</span> <span class="s2">&quot;gmres.restart&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
                               <span class="c1"># the scheme uses Eisenstat-Walker forcing</span>
                               <span class="c1"># with &#39;residual reduction&#39; as error measure</span>
                               <span class="c1"># without the forcing &#39;absolute&#39; is the default error measure</span>
                               <span class="s2">&quot;errormeasure&quot;</span><span class="p">:</span><span class="s2">&quot;absolute&quot;</span><span class="p">,</span>
                            <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">linIter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="c1"># we are not computing the residual directly so need a different</span>
        <span class="c1"># stopping criteria, i.e., size of the step dh</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># setup L[u] = DS[u^n](u-u^n) + S[u^n]</span>
            <span class="c1"># Then L[u] = 0 leads to</span>
            <span class="c1"># u = (DS[u^n])^{-1} (DS[u^n]u^n-S[u^n])</span>
            <span class="c1">#   = u^n - DS[u^n])^{-1}S[u^n]</span>
            <span class="c1">#   = u^{n+1}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="n">linIter</span> <span class="o">+=</span> <span class="n">info</span><span class="p">[</span><span class="s2">&quot;linear_iterations&quot;</span><span class="p">]</span>

            <span class="c1"># We don&#39;t have access to the residual so we use |u^{n+1}-u^n|</span>
            <span class="c1"># as stopping criteria.</span>
            <span class="c1"># Subtract the new iterate from the previous one</span>
            <span class="n">prev</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span> <span class="n">target</span> <span class="p">)</span>
            <span class="n">absDiff</span> <span class="o">=</span> <span class="n">prev</span><span class="o">.</span><span class="n">scalarProductDofs</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">absDiff</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">absDiff</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="o">**</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">prev</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;iterations&quot;</span><span class="p">:</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;linear_iterations&quot;</span><span class="p">:</span><span class="n">linIter</span><span class="p">}</span>

<span class="n">u_h</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>                         <span class="c1"># reset u_h - so we start the Newton method with u_h=0</span>
<span class="n">scheme_cls</span> <span class="o">=</span> <span class="n">Scheme2</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme_cls</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Newton 2 (gmres)&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 141085.76467817265
1 17905.922126842455
2 7537.485971022514
3 2816.7398167325914
4 729.4502131630727
5 67.95222228769525
6 0.5837225090318674
7 4.080727400222704e-05
8 0.0
Newton 2 (gmres) L^2, H^1 error: 1.17601e-06, 1.83002e-04
         solver info= {&#39;iterations&#39;: 8, &#39;linear_iterations&#39;: 2076}
</pre></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>the parameters used to tweak the linear solver set when constructing the <code class="docutils literal notranslate"><span class="pre">scheme</span></code> are passed on to the linear solver when calling <code class="docutils literal notranslate"><span class="pre">scheme.linear</span></code> but can be overwritten. Below we construct a linearization (by default around zero) which uses a <code class="docutils literal notranslate"><span class="pre">gmres</span></code> method when calling <code class="docutils literal notranslate"><span class="pre">jac.solve</span></code> - the same would work with <code class="docutils literal notranslate"><span class="pre">sc.linear(parameter={..})</span></code>.</p>
</div>
<p>Here is another example of this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="p">(</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">conditional</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">10.</span><span class="p">,</span><span class="mf">0.</span><span class="p">))</span><span class="o">*</span><span class="n">v</span> <span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
<span class="c1"># verbose output for the linear solver is too long so use default `False` setting</span>
<span class="n">sc</span>  <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span><span class="n">model</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;cg&quot;</span><span class="p">,</span>
               <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;linear.verbose&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;nonlinear.verbose&quot;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
              <span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u_h&quot;</span><span class="p">)</span>
<span class="n">jac</span> <span class="o">=</span> <span class="n">linearized</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="p">{</span> <span class="s2">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;gmres&quot;</span><span class="p">,</span> <span class="s2">&quot;gmres.restart&quot;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span> <span class="p">})</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">jac</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;converged&#39;: True, &#39;iterations&#39;: 0, &#39;linear_iterations&#39;: 1106, &#39;timing&#39;: []}
</pre></div></div>
</div>
<p>Since we setup the <code class="docutils literal notranslate"><span class="pre">scheme</span></code> using <code class="docutils literal notranslate"><span class="pre">solver=&quot;cg&quot;</span></code> calling the <code class="docutils literal notranslate"><span class="pre">solve</span></code> method will use the Newton method with a <code class="docutils literal notranslate"><span class="pre">cg</span></code> solver - some verbose output is provided in each step of the Newton method due to <code class="docutils literal notranslate"><span class="pre">&quot;nonlinear.verbose&quot;:True</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sol</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">sol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;converged&#39;: True, &#39;iterations&#39;: 0, &#39;linear_iterations&#39;: 213, &#39;timing&#39;: [0.025146098, 0.004754108999999999, 0.020391989]}
</pre></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>since the problem is linear the Newton method produces no real overhead.</p>
</div>
</section>
<section id="Handling-Dirichlet-boundary-conditions">
<span id="index-1"></span><span id="index-0"></span><h2>Handling Dirichlet boundary conditions<a class="headerlink" href="#Handling-Dirichlet-boundary-conditions" title="Link to this heading"></a></h2>
<p>We first look at a simple Poisson problem with Dirichlet BCs to show how to use the internal solvers in this setting. We solve <span class="math notranslate nohighlight">\(-\triangle u=15\chi_\omega\)</span> where <span class="math notranslate nohighlight">\(\chi_\omega\)</span> is a characteristic function with <span class="math notranslate nohighlight">\(\omega=\{x\colon |x|^2&lt;0.6\}\)</span>. For the boundary we prescribe trivial Neumann at the top and bottom boundaries and Dirichlet values <span class="math notranslate nohighlight">\(u=-1\)</span> and <span class="math notranslate nohighlight">\(u=1\)</span> at the left and right boundaries, respectively.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dune.ufl</span><span class="w"> </span><span class="kn">import</span> <span class="n">DirichletBC</span>
<span class="n">model</span> <span class="o">=</span> <span class="p">(</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">-</span> <span class="mi">15</span><span class="o">*</span><span class="n">conditional</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span> <span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">dbcs</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">DirichletBC</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">DirichletBC</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">]</span>
<span class="n">op</span>  <span class="o">=</span> <span class="n">galerkin</span><span class="p">([</span><span class="n">model</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">dbcs</span><span class="p">],</span> <span class="n">space</span><span class="p">)</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;u_h&quot;</span><span class="p">)</span>
<span class="n">lin</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">linear</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>So far everything is as before. Dirichlet boundary conditions are handled in the matrix through changing all rows associated with boundary degrees of freedom to unit rows - associated columns are not changed so the matrix will not be symmetric anymore. For solving the system we need to modify the right hand side and the initial guess for the iterative solver to include the boundary values (to counter the missing symmetry). We can use the first of the three versions of the <code class="docutils literal notranslate"><span class="pre">setConstraints</span></code>
methods on the scheme class discussed in the section on <a class="reference internal" href="boundary_nb.html#Accessing-the-Dirichlet-degrees-of-freedom"><span class="std std-ref">more general boundary conditions</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">op</span><span class="o">.</span><span class="n">setConstraints</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

<span class="c1"># setup the right hand side</span>
<span class="n">rhs</span> <span class="o">=</span> <span class="n">sol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">op</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span><span class="n">rhs</span><span class="p">)</span>
<span class="n">rhs</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">op</span><span class="o">.</span><span class="n">setConstraints</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span>
<span class="n">lin</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">rightHandSide</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="n">sol</span><span class="p">)</span>
<span class="n">sol</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/solversInternal_nb_19_0.jpg" src="_images/solversInternal_nb_19_0.jpg" />
</div>
</div>
<p>Let’s revisit our two implementations of the Newton method discussed above but with Dirichlet conditions on the whole boundary:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scheme</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">([</span><span class="n">a</span> <span class="o">==</span> <span class="n">bf</span><span class="p">,</span> <span class="n">DirichletBC</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">exact</span><span class="p">)],</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;cg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>First version with <code class="docutils literal notranslate"><span class="pre">scheme.linear</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>                        <span class="c1"># start with the boundary conditions at the top</span>
<span class="n">scheme_cls</span> <span class="o">=</span> <span class="n">Scheme1</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span><span class="n">u0</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme_cls</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Dirichlet, Newton 1&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dirichlet, Newton 1 L^2, H^1 error: 1.17658e-06, 1.83002e-04
         solver info= {&#39;iterations&#39;: 4, &#39;linear_iterations&#39;: 414}
</pre></div></div>
</div>
<p>and using the <code class="docutils literal notranslate"><span class="pre">linearized</span></code> operator:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scheme_cls</span> <span class="o">=</span> <span class="n">Scheme2</span><span class="p">(</span><span class="n">scheme</span><span class="p">,</span><span class="n">u0</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme_cls</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Dirichlet, Newton 2&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 994.7300931673126
1 14.080846388373416
2 0.005556564215679982
3 1.0225993011519528e-09
4 0.0
Dirichlet, Newton 2 L^2, H^1 error: 1.17659e-06, 1.83002e-04
         solver info= {&#39;iterations&#39;: 4, &#39;linear_iterations&#39;: 518}
</pre></div></div>
</div>
</section>
<section id="Other-internal-solvers-(petsc)">
<h2>Other internal solvers (petsc)<a class="headerlink" href="#Other-internal-solvers-(petsc)" title="Link to this heading"></a></h2>
<p id="index-2">The following requires that a PETSc installation was found during the configuration of <code class="docutils literal notranslate"><span class="pre">dune</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dune.common.checkconfiguration</span><span class="w"> </span><span class="kn">import</span> <span class="n">assertCMakeHave</span><span class="p">,</span> <span class="n">ConfigurationError</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">assertCMakeHave</span><span class="p">(</span><span class="s2">&quot;HAVE_PETSC&quot;</span><span class="p">)</span>
    <span class="n">petsc</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="n">ConfigurationError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dune not configured with petsc - skipping example&quot;</span><span class="p">)</span>
    <span class="n">petsc</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
<p>We provide internal bindings to parts of the PETSc package and show this first. How to make use of <code class="docutils literal notranslate"><span class="pre">petsc4py</span></code> is shown <a class="reference internal" href="solversExternal_nb.html"><span class="doc">in a later section</span></a>.</p>
<p>Switching to a storage based on the PETSc solver package and solving the system using the dune-fem bindings can be achieved by using the <code class="docutils literal notranslate"><span class="pre">storage</span></code> argument to the space constructor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We can use the ufl forms we already have defined. Normally the space to use is extracted from the form but this can be overwritten by providing a <code class="docutils literal notranslate"><span class="pre">space</span></code> argument during scheme construction.</p>
</div>
<p>We’ll use Dirichlet BCs at the left boundary only:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">petsc</span><span class="p">:</span>
    <span class="n">spacePetsc</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">gridView</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;petsc&#39;</span><span class="p">)</span>
    <span class="c1"># We use an sor preconditioner:</span>
    <span class="n">schemePetsc</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">([</span><span class="n">a</span> <span class="o">==</span> <span class="n">bf</span><span class="o">+</span><span class="n">bg</span><span class="p">,</span> <span class="n">DirichletBC</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">exact</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span>
                           <span class="n">space</span><span class="o">=</span><span class="n">spacePetsc</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;cg&quot;</span><span class="p">,</span>
                           <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;linear.preconditioning.method&quot;</span><span class="p">:</span><span class="s2">&quot;hypre&quot;</span><span class="p">})</span>
    <span class="n">uPetsc_h</span> <span class="o">=</span> <span class="n">spacePetsc</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;u_h&#39;</span><span class="p">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">schemePetsc</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">uPetsc_h</span><span class="p">)</span>
    <span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;PETSc&quot;</span><span class="p">,</span><span class="n">uPetsc_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PETSc L^2, H^1 error: 1.17613e-06, 1.83002e-04
         solver info= {&#39;converged&#39;: True, &#39;iterations&#39;: 4, &#39;linear_iterations&#39;: 22, &#39;timing&#39;: [0.078212362, 0.049349553000000004, 0.02886280899999999]}
</pre></div></div>
</div>
</section>
<section id="Other-internal-solvers-(istl)">
<h2>Other internal solvers (istl)<a class="headerlink" href="#Other-internal-solvers-(istl)" title="Link to this heading"></a></h2>
<p id="index-3">We can just as easily use the <code class="docutils literal notranslate"><span class="pre">dune-istl</span></code> package to solve the system (<code class="docutils literal notranslate"><span class="pre">dune-istl</span></code> should be available when installing <code class="docutils literal notranslate"><span class="pre">dune-fem</span></code>).</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>instead of changing the storage in the space requiring some extra compilation it is also possible to provide the solver information directly to the scheme as shown here.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spaceIstl</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">gridView</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">storage</span><span class="o">=</span><span class="s1">&#39;istl&#39;</span><span class="p">)</span>
<span class="c1"># We use an amg preconditioner:</span>
<span class="n">schemeIstl</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">bf</span><span class="o">+</span><span class="n">bg</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;istl&quot;</span><span class="p">,</span><span class="s2">&quot;cg&quot;</span><span class="p">),</span>
                      <span class="n">parameters</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;linear.preconditioning.method&quot;</span><span class="p">:</span><span class="s2">&quot;amg-jacobi&quot;</span><span class="p">})</span>
<span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">schemeIstl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">printResult</span><span class="p">(</span><span class="s2">&quot;Dune-Istl&quot;</span><span class="p">,</span><span class="n">u_h</span><span class="o">-</span><span class="n">exact</span><span class="p">,</span><span class="n">info</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dune-Istl L^2, H^1 error: 1.17597e-06, 1.83002e-04
         solver info= {&#39;converged&#39;: True, &#39;iterations&#39;: 4, &#39;linear_iterations&#39;: 42, &#39;timing&#39;: [0.107077367, 0.020071142, 0.087006225]}
</pre></div></div>
</div>
</section>
<section id="Parameters-for-fine-tuning-the-internal-solvers">
<span id="index-4"></span><h2>Parameters for fine-tuning the internal solvers<a class="headerlink" href="#Parameters-for-fine-tuning-the-internal-solvers" title="Link to this heading"></a></h2>
<p>Sometimes it is necessary to extract which parameters were read and which values were used, e.g., for debugging purposes like finding spelling in the parameters provided to a scheme. Note that this information can only be reliably obtained after usage of the scheme, e.g., after calling solve as shown in the example below. To add logging to a set of parameters passed to a <code class="docutils literal notranslate"><span class="pre">scheme</span></code> one simply needs to add a <code class="docutils literal notranslate"><span class="pre">logging</span></code> key to the parameter dictionary provided to the scheme with a tag (string)
that is used in the output.</p>
<p>As an example we will solve the simple Laplace equation from the introduction but pass some preconditioning parameters to the scheme.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">dune.fem</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dune.grid</span><span class="w"> </span><span class="kn">import</span> <span class="n">structuredGrid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dune.fem.space</span><span class="w"> </span><span class="kn">import</span> <span class="n">lagrange</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ufl</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">TestFunction</span><span class="p">,</span> <span class="n">TrialFunction</span><span class="p">,</span> <span class="n">SpatialCoordinate</span><span class="p">,</span>
                 <span class="n">dx</span><span class="p">,</span> <span class="n">grad</span><span class="p">,</span> <span class="n">inner</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span> <span class="p">)</span>
<span class="n">gridView</span> <span class="o">=</span> <span class="n">structuredGrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">])</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">gridView</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">u_h</span>   <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;u_h&#39;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">TrialFunction</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">TestFunction</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">(</span> <span class="n">inner</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">+</span> <span class="n">u</span><span class="o">*</span><span class="n">v</span> <span class="p">)</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">l</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">v</span> <span class="o">*</span> <span class="n">dx</span>
<span class="n">scheme</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span> <span class="n">a</span><span class="o">==</span><span class="n">l</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;cg&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span>
                   <span class="p">{</span><span class="s2">&quot;linear.tolerance&quot;</span><span class="p">:</span> <span class="mf">1e-12</span><span class="p">,</span>
                    <span class="s2">&quot;linear.verbose&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s2">&quot;linear.preconditioning.method&quot;</span><span class="p">:</span> <span class="s2">&quot;jacobi&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;linear.errormeasure&quot;</span><span class="p">:</span> <span class="s2">&quot;relative&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="s2">&quot;log-jacobi&quot;</span>
                   <span class="p">}</span> <span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Fem::CG preconditioning=jacobi
Fem::CG it: 0 : sqr(residuum) 9.91003e-26
Fem::CG it: 1 : sqr(residuum) 1.1676e-26
</pre></div></div>
</div>
<p>We use the <code class="docutils literal notranslate"><span class="pre">pprint</span></code> (pretty print) module if available to get nicer output.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">_pprint</span>
    <span class="n">pprint</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_pprint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">compact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">pprint</span> <span class="o">=</span> <span class="nb">print</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">dune</span><span class="o">.</span><span class="n">fem</span><span class="o">.</span><span class="n">parameter</span><span class="o">.</span><span class="n">log</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;default&#39;: {(&#39;fem.solver.threading&#39;, &#39;true&#39;), (&#39;fem.dofmanager.clearresizedarrays&#39;, &#39;true&#39;), (&#39;fem.dofmanager.memoryfactor&#39;, &#39;1.1&#39;), (&#39;fem.threads.communicationthread&#39;, &#39;false&#39;)},
 &#39;log-jacobi&#39;: {(&#39;fem.solver.linear.maxiterations&#39;, &#39;2147483647&#39;),
                (&#39;fem.solver.linear.preconditioning.iterations&#39;, &#39;1&#39;),
                (&#39;fem.solver.linear.preconditioning.relaxation&#39;, &#39;1.1&#39;),
                (&#39;fem.solver.linear.threading&#39;, &#39;true&#39;),
                (&#39;fem.solver.nonlinear.forcenonlinear&#39;, &#39;false&#39;),
                (&#39;fem.solver.nonlinear.forcing&#39;, &#39;none&#39;),
                (&#39;fem.solver.nonlinear.linesearch&#39;, &#39;none&#39;),
                (&#39;fem.solver.nonlinear.maxiterations&#39;, &#39;2147483647&#39;),
                (&#39;fem.solver.nonlinear.maxlinesearchiterations&#39;, &#39;2147483647&#39;),
                (&#39;fem.solver.nonlinear.simplified&#39;, &#39;false&#39;),
                (&#39;fem.solver.nonlinear.tolerance&#39;, &#39;1e-06&#39;),
                (&#39;fem.solver.nonlinear.verbose&#39;, &#39;false&#39;),
                (&#39;linear.errormeasure&#39;, &#39;relative&#39;),
                (&#39;linear.method&#39;, &#39;cg&#39;),
                (&#39;linear.preconditioning.method&#39;, &#39;jacobi&#39;),
                (&#39;linear.tolerance&#39;, &#39;1e-12&#39;),
                (&#39;linear.verbose&#39;, &#39;True&#39;)},
 &#39;program code&#39;: {(&#39;fem.adaptation.method&#39;, &#39;callback&#39;)}}
</pre></div></div>
</div>
<p>Note above that all parameters are printed including some default ones used in other parts of the code. If multiple schemes with different <code class="docutils literal notranslate"><span class="pre">logging</span></code> parameter strings are used, all would be shown using the <code class="docutils literal notranslate"><span class="pre">log</span></code> method as shown above. To access only the parameters used in the scheme simply use either <code class="docutils literal notranslate"><span class="pre">dune.fem.parameter.log()[&quot;tag&quot;])</span></code> or access the parameter log through the scheme:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">scheme</span><span class="o">.</span><span class="n">parameterLog</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;fem.solver.linear.maxiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.linear.preconditioning.iterations&#39;, &#39;1&#39;),
 (&#39;fem.solver.linear.preconditioning.relaxation&#39;, &#39;1.1&#39;),
 (&#39;fem.solver.linear.threading&#39;, &#39;true&#39;),
 (&#39;fem.solver.nonlinear.forcenonlinear&#39;, &#39;false&#39;),
 (&#39;fem.solver.nonlinear.forcing&#39;, &#39;none&#39;),
 (&#39;fem.solver.nonlinear.linesearch&#39;, &#39;none&#39;),
 (&#39;fem.solver.nonlinear.maxiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.nonlinear.maxlinesearchiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.nonlinear.simplified&#39;, &#39;false&#39;),
 (&#39;fem.solver.nonlinear.tolerance&#39;, &#39;1e-06&#39;),
 (&#39;fem.solver.nonlinear.verbose&#39;, &#39;false&#39;),
 (&#39;linear.errormeasure&#39;, &#39;relative&#39;),
 (&#39;linear.method&#39;, &#39;cg&#39;),
 (&#39;linear.preconditioning.method&#39;, &#39;jacobi&#39;),
 (&#39;linear.tolerance&#39;, &#39;1e-12&#39;),
 (&#39;linear.verbose&#39;, &#39;True&#39;)}
</pre></div></div>
</div>
<p>One can easily reuse these parameters to construct another scheme by converting the result of the above call to a dictionary. As an example change the above problem to a PDE with Dirichlet conditions but turn off verbose output of the solver.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">logging</span></code> parameter has to be set if we want to use the <code class="docutils literal notranslate"><span class="pre">parameterLog</span></code> method on the scheme.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">scheme</span><span class="o">.</span><span class="n">parameterLog</span><span class="p">())</span> <span class="c1"># this method returns a set of pairs which we can convert to a dictionary</span>
<span class="n">param</span><span class="p">[</span><span class="s2">&quot;logging&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Dirichlet&quot;</span> <span class="c1"># only needed to use the `parameterLog` method</span>
<span class="n">param</span><span class="p">[</span><span class="s2">&quot;linear.verbose&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">scheme2</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span> <span class="p">[</span><span class="n">a</span><span class="o">==</span><span class="n">l</span><span class="p">,</span><span class="n">DirichletBC</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="mi">0</span><span class="p">)],</span> <span class="n">parameters</span><span class="o">=</span><span class="n">param</span> <span class="p">)</span>
<span class="n">u_h</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">info</span> <span class="o">=</span> <span class="n">scheme2</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">scheme2</span><span class="o">.</span><span class="n">parameterLog</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{(&#39;fem.solver.linear.maxiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.linear.preconditioning.iterations&#39;, &#39;1&#39;),
 (&#39;fem.solver.linear.preconditioning.relaxation&#39;, &#39;1.1&#39;),
 (&#39;fem.solver.linear.threading&#39;, &#39;true&#39;),
 (&#39;fem.solver.nonlinear.forcenonlinear&#39;, &#39;false&#39;),
 (&#39;fem.solver.nonlinear.forcing&#39;, &#39;none&#39;),
 (&#39;fem.solver.nonlinear.linesearch&#39;, &#39;none&#39;),
 (&#39;fem.solver.nonlinear.maxiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.nonlinear.maxlinesearchiterations&#39;, &#39;2147483647&#39;),
 (&#39;fem.solver.nonlinear.simplified&#39;, &#39;false&#39;),
 (&#39;fem.solver.nonlinear.tolerance&#39;, &#39;1e-06&#39;),
 (&#39;fem.solver.nonlinear.verbose&#39;, &#39;false&#39;),
 (&#39;linear.errormeasure&#39;, &#39;relative&#39;),
 (&#39;linear.method&#39;, &#39;cg&#39;),
 (&#39;linear.preconditioning.method&#39;, &#39;jacobi&#39;),
 (&#39;linear.tolerance&#39;, &#39;1e-12&#39;),
 (&#39;linear.verbose&#39;, &#39;False&#39;)}
</pre></div></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To get information about available values for some parameters (those with string arguments) a possible approach is to provide a non valid string, e.g., <code class="docutils literal notranslate"><span class="pre">&quot;help&quot;</span></code>.</p>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">scheme</span> <span class="o">=</span> <span class="n">galerkin</span><span class="p">(</span> <span class="n">a</span><span class="o">==</span><span class="n">l</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s2">&quot;cg&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span>
                       <span class="p">{</span><span class="s2">&quot;linear.tolerance&quot;</span><span class="p">:</span> <span class="mf">1e-12</span><span class="p">,</span>
                        <span class="s2">&quot;linear.verbose&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;linear.preconditioning.method&quot;</span><span class="p">:</span> <span class="s2">&quot;help&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;linear.errormeasure&quot;</span><span class="p">:</span> <span class="s2">&quot;relative&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="s2">&quot;precon&quot;</span>
                       <span class="p">}</span> <span class="p">)</span>
    <span class="n">scheme</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">u_h</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">rte</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rte</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help for parameter &#39;fem.solver.linear.preconditioning.method&#39;:
Valid values are: none, sor, ssor, gauss-seidel, jacobi

</pre></div></div>
</div>
</section>
<section id="Available-solvers-and-parameters">
<span id="index-5"></span><h2>Available solvers and parameters<a class="headerlink" href="#Available-solvers-and-parameters" title="Link to this heading"></a></h2>
<p>Upon creation of a discrete function space one also have to specifies the storage which is tied to the solver backend. As mentioned, different linear algebra backends can be accessed by changing setting the <code class="docutils literal notranslate"><span class="pre">storage</span></code> parameter during construction of the discrete space. All discrete functions and operators/schemes based on this space will then use this backend. Available backends are <code class="docutils literal notranslate"><span class="pre">numpy,istl,petsc</span></code>. Note that not all methods which are available in <code class="docutils literal notranslate"><span class="pre">dune-istl</span></code> or <code class="docutils literal notranslate"><span class="pre">PETSc</span></code> have been
forwarded to be used with <code class="docutils literal notranslate"><span class="pre">dune-fem</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">space</span> <span class="o">=</span> <span class="n">lagrange</span><span class="p">(</span><span class="n">gridView</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Switching is as simple as passing <code class="docutils literal notranslate"><span class="pre">storage='istl'</span></code> or <code class="docutils literal notranslate"><span class="pre">storage='petsc'</span></code>. Here is a summary of the available backends</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Solver</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>numpy</p></td>
<td><p>the storage is based on a raw C pointer which can be</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>directly accessed as a numpy.array using the Python buffer protocol</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>To change the underlying vector of a discrete function <code class="docutils literal notranslate"><span class="pre">u_h</span></code> use</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">uh.as_numpy[:]</span></code>.</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>As shown in the examples, linear operators return a</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">scipy.sparse.csr_matrix</span></code> through the <code class="docutils literal notranslate"><span class="pre">as_numpy</span></code> property.</p></td>
</tr>
<tr class="row-even"><td><p>istl</p></td>
<td><p>data is stored in a block vector/matrix from the dune.istl package</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>Access through <code class="docutils literal notranslate"><span class="pre">as_istl</span></code></p></td>
</tr>
<tr class="row-even"><td><p>petsc</p></td>
<td><p>data is stored in a petsc vector/matrix which can also be used with</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>petsc4py on the python side using <code class="docutils literal notranslate"><span class="pre">as_petsc</span></code>.</p></td>
</tr>
</tbody>
</table>
<p id="index-6">When creating a scheme, there is the possibility to select a linear solver for the internal Newton method. In addition the behavior of the solver can be customized through a parameter dictionary. This allows to set tolerances, verbosity, but also which preconditioner to use.</p>
<p>For details see the help available for a scheme:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">scheme</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on Scheme in module dune.generated.femscheme_1830e0b499d58f20cb34ce353560f035 object:

class Scheme(pybind11_builtins.pybind11_object)
 |  A scheme finds a solution `u=ufl.TrialFunction` for a given variational equation.
 |  The main method is `solve` which takes a discrete functions as `target` argument to
 |  store the solution. The method always uses a Newton method to solve the problem.
 |  The linear solver used in each iteration of the Newton method can be chosen
 |  using the `solver` parameter in the constructor of the scheme. Available solvers are:
 |  ------------------------------------------
 |  |  Solver  |         Storage             |
 |  |   name   |  numpy  |  istl   |  petsc  |
 |  |----------|---------|---------|---------|
 |  | bicg     |   ---   |   ---   |    x    |
 |  | bicgstab |    x    |    x    |    x    |
 |  | cg       |    x    |    x    |    x    |
 |  | gmres    |    x    |    x    |    x    |
 |  | gradient |   ---   |    x    |   ---   |
 |  | loop     |   ---   |    x    |   ---   |
 |  | minres   |   ---   |    x    |    x    |
 |  | preonly  |   ---   |   ---   |    x    |
 |  | superlu  |   ---   |    x    |   ---   |
 |  ------------------------------------------
 |
 |  In addition the direct solvers from the `suitesparse` package can be used with the
 |  `numpy` storage. In this case provide a tuple as `solver` argument with &#34;suitesparse&#34; as
 |  first argument and the solver to use as second, e.g.,
 |  &#39;solver=(&#34;suitesparse&#34;,&#34;umfpack&#34;)&#39;.
 |
 |  The detailed behavior of the schemes can be customized by providing a
 |  `parameters` dictionary to the scheme constructor, e.g.,
 |     {&#34;nonlinear.tolerance&#34;: 1e-3,       # tolerance for newton solver
 |      &#34;nonlinear.verbose&#34;: False,        # toggle iteration output
 |      &#34;nonlinear.maxiterations&#34;: maxInt, # max number of nonlinear iterations
 |      &#34;nonlinear.linesearch&#34;: True,      # use a simple bisection line search
 |      &#34;nonlinear.forcing&#34;: &#34;none&#34;,       # can switch to eisenstatwalker
 |      &#34;nonlinear.simplified&#34;: False,     # use a quasi Newton method with single Jacobian evaluation
 |
 |      &#34;linear.tolerance&#34;: 1e-5,          # tolerance for linear solver
 |      &#34;linear.verbose&#34;: False,           # toggle linear iteration output
 |      &#34;linear.maxiterations&#34;:1000,       # max number of linear iterations
 |      &#34;linear.errormeasure&#34;: &#34;absolute&#34;, # or &#34;relative&#34; or &#34;residualreduction&#34;
 |
 |      &#34;linear.preconditioning.method&#34;: &#34;jacobi&#34;,          # (see table below)
 |      &#34;linear.preconditioning.hypre.method&#34;: &#34;boomeramg&#34;, #  &#34;pilu-t&#34; &#34;parasails&#34;
 |      &#34;linear.preconditioning.iteration&#34;: 3,              # iterations for preconditioner
 |      &#34;linear.preconditioning.relaxation&#34;: 1.0,           # omega for SOR and ILU
 |      &#34;linear.preconditioning.level&#34;: 0}                  # fill-in level for ILU preconditioning
 |  -----------------------------------------------
 |  |  Precondition | (x = parallel | s = serial) |
 |  |  method       |  numpy  |   istl  |  petsc  |
 |  |---------------|---------|---------|---------|
 |  | amg-ilu       |   ---   |    x    |   ---   |
 |  | amg-jacobi    |   ---   |    x    |   ---   |
 |  | gauss-seidel  |    x    |    x    |    x    |
 |  | hypre         |   ---   |   ---   |    x    |
 |  | icc           |   ---   |   ---   |    x    |
 |  | ildl          |   ---   |    x    |   ---   |
 |  | ilu           |   ---   |    s    |    s    |
 |  | jacobi        |    x    |    x    |    x    |
 |  | kspoptions    |   ---   |   ---   |    x    |
 |  | lu            |   ---   |   ---   |    s    |
 |  | ml            |   ---   |   ---   |    x    |
 |  | none          |    x    |    x    |    x    |
 |  | oas           |   ---   |   ---   |    x    |
 |  | pcgamg        |   ---   |   ---   |    x    |
 |  | sor           |    x    |    x    |    x    |
 |  | ssor          |    x    |    x    |    x    |
 |  -----------------------------------------------
 |
 |  The functionality of some of the preconditioners listed for petsc will
 |  depend on the petsc installation.
 |
 |  Method resolution order:
 |      Scheme
 |      pybind11_builtins.pybind11_object
 |      builtins.object
 |
 |  Methods defined here:
 |
 |  __call__(...)
 |
 |  __init__(...)
 |
 |  dirichletIndices = _opDirichletIndices(self, id=None) from dune.fem.operator
 |
 |  inverseLinearOperator(...)
 |
 |  jacobian(...)
 |
 |  linear = _linearized(scheme, ubar=None, assemble=True, parameters={}, onlyLinear=True) from dune.fem.scheme._schemes
 |
 |  setErrorMeasure(...)
 |
 |  setQuadratureOrders(...)
 |
 |  solve(scheme, target, rhs=None, *, rightHandSide=None) from dune.fem.scheme
 |
 |  ----------------------------------------------------------------------
 |  Readonly properties defined here:
 |
 |  cppIncludes
 |
 |  cppTypeName
 |
 |  dimRange
 |
 |  domainSpace
 |
 |  parameterHelp
 |
 |  rangeSpace
 |
 |  space
 |
 |  ----------------------------------------------------------------------
 |  Data descriptors defined here:
 |
 |  __dict__
 |
 |  ----------------------------------------------------------------------
 |  Data and other attributes defined here:
 |
 |  LinearInverseOperator = &lt;class &#39;dune.generated.femscheme_1830e0b499d58...
 |
 |  ----------------------------------------------------------------------
 |  Static methods inherited from pybind11_builtins.pybind11_object:
 |
 |  __new__(*args, **kwargs) class method of pybind11_builtins.pybind11_object
 |      Create and return a new object.  See help(type) for accurate signature.

</pre></div></div>
</div>
</section>
</section>
<div class="admonition note">
<p class="admonition-title">Note</p>
This document is part of the dune-fem tutorial
<a href="https://doi.org/10.5281/zenodo.3706994"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.3706994.svg" alt="DOI"></a><div class="line-block">
<div class="line">Download <em>solversInternal</em> as <a class="reference download internal" download="" href="_downloads/3385c1e627e7349eab78727455fc0e93/solversInternal_nb.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">notebook</span> <span class="pre">(.ipynb)</span></code></a> or as <a class="reference download internal" download="" href="_downloads/d01f5757879fef2679cefb65d469f266/solversInternal.py"><code class="xref download docutils literal notranslate"><span class="pre">Python</span> <span class="pre">script</span> <span class="pre">(.py)</span></code></a></div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="boundary_nb.html" class="btn btn-neutral float-left" title="More General Boundary Conditions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="solversExternal_nb.html" class="btn btn-neutral float-right" title="Alternative Solvers (e.g. Scipy, Petsc)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2025, Andreas Dedner and Robert Klöfkorn.
      <span class="lastupdated">Last updated on Dec 02, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>