

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Grid views and adaptivity &mdash; Tutorial for version 2.11-git</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=5929fcd5"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            
              <img src="_static/dune-python-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
     <span class="caption-text">
     <li><u><a href="genindex.html" style="color:white">Keyword list</a></u></li>
     <li><u><a href="changelog290.html" style="color:white">Most recent changes</a></u></li>
     </span>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">An Overview of this Document</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">From PyPi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#hints-for-windows">Hints for Windows</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#from-source">From Source</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#building-the-required-dune-modules">Building the Required Dune Modules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html#troubleshooting">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="dune-fempy_nb.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#A-Laplace-problem">A Laplace problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#Laplace-equation-with-Dirichlet-boundary-conditions">Laplace equation with Dirichlet boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#A-non-linear-elliptic-problem">A non-linear elliptic problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-fempy_nb.html#Using-Constant-parameters-and-grid-functions-in-PDEs">Using <code class="docutils literal notranslate"><span class="pre">Constant</span></code> parameters and grid functions in PDEs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concepts_nb.html">General Concepts (with a time dependent problem)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Setting-up-the-Grid">Setting up the Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Grid-Functions">Grid Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Discrete-Spaces">Discrete Spaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Discrete-Functions">Discrete Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Operators-and-Schemes">Operators and Schemes</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#A-Nonlinear-Time-Dependent-Problem">A Nonlinear Time Dependent Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts_nb.html#Listing-Available-Dune-Components">Listing Available Dune Components</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Next Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="boundary_nb.html">More General Boundary Conditions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Dirichlet-boundary-conditions">Dirichlet boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Accessing-the-Dirichlet-degrees-of-freedom">Accessing the Dirichlet degrees of freedom</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Neumann-and-Robin-boundary-conditions">Neumann and Robin boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary_nb.html#Using-boundary-ids-(and-some-more-complex-examples)">Using boundary ids (and some more complex examples)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="boundary_nb.html#Cartesian-boundary-ids">Cartesian boundary ids</a></li>
<li class="toctree-l3"><a class="reference internal" href="boundary_nb.html#Mixing-different-types-of-boundary-conditions">Mixing different types of boundary conditions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="othergrids_nb.html">Examples of grid construction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Example-using-the-Dune-Grid-Format-(DGF)">Example using the Dune Grid Format (DGF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#3D-example-(using-PyGmsh)">3D example (using PyGmsh)</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Converting-gmsh-to-DGF">Converting gmsh to DGF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="othergrids_nb.html#Attaching-boundary-ids-to-a-grid-constructed-with-gmsh-using-DGF">Attaching boundary ids to a grid constructed with gmsh using DGF</a></li>
<li class="toctree-l3"><a class="reference internal" href="othergrids_nb.html#Visualizing-Boundary-Ids">Visualizing Boundary Ids</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#Using-meshio-to-read-a-gmsh-file">Using <code class="docutils literal notranslate"><span class="pre">meshio</span></code> to read a gmsh file</a></li>
<li class="toctree-l2"><a class="reference internal" href="othergrids_nb.html#1D-example">1D example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parallelization_nb.html">Parallelization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parallelization_nb.html#OpenMP">OpenMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="parallelization_nb.html#MPI">MPI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parallelization_nb.html#Load-balancing">Load balancing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="backuprestore_nb.html">Backup and restore (pickling)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="backuprestore_nb.html#Pickling">Pickling</a></li>
<li class="toctree-l2"><a class="reference internal" href="backuprestore_nb.html#A-Chekpointer-class">A Chekpointer class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="corepy.html">Using the Full Grid Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Dense-Vectors-and-the-Geometry-Classes">Dense Vectors and the Geometry Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Grid-Construction-and-Basic-Interface">Grid Construction and Basic Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Structured-grids">Structured grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Unstructured-grids">Unstructured grids</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Local-grid-adaptivity">Local grid adaptivity</a><ul>
<li class="toctree-l4"><a class="reference internal" href="dune-corepy_nb.html#Basic-information-and-iterators">Basic information and iterators</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Using-grid-functions">Using grid functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Importing-user-defined-C++-code">Importing user defined C++ code</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Attaching-Data-to-the-Grid">Attaching Data to the Grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="dune-corepy_nb.html#Output-of-Grid-and-Visualization-of-Data">Output of Grid and Visualization of Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Matplotlib">Matplotlib</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Paraview-(vtu/vtk-files)">Paraview (vtu/vtk files)</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Mayavi">Mayavi</a></li>
<li class="toctree-l3"><a class="reference internal" href="dune-corepy_nb.html#Low-level-output">Low level output</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="discontinuousgalerkin_nb.html">Discontinuous Galerkin Methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="discontinuousgalerkin_nb.html#Advection-Diffusion:-Discontinuous-Galerkin-Method-with-Upwinding">Advection-Diffusion: Discontinuous Galerkin Method with Upwinding</a></li>
<li class="toctree-l2"><a class="reference internal" href="discontinuousgalerkin_nb.html#A-linear-transport-problem">A linear transport problem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="elasticity_nb.html">Linear Elasticity: a deformed beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="spiral_nb.html">Time Dependent Reaction Diffuison: spiral wave</a></li>
<li class="toctree-l1"><a class="reference internal" href="wave_nb.html">Wave Equation: double slit domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="stokes.html">Saddle point solver for the stationary Stokes problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="monolithicStokes_nb.html">Monolithic solver (Lagrange and DG formulation)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="monolithicStokes_nb.html#Taylor-Hood-formulation">Taylor-Hood formulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="monolithicStokes_nb.html#Bercovier-Engelmann-Testcase">Bercovier-Engelmann Testcase</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="monolithicStokes_nb.html#DG-formulation">DG formulation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="monolithicStokes_nb.html#id3">Bercovier-Engelmann Testcase</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="monolithicStokes_nb.html#Convergence-rate-check">Convergence rate check</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="fieldsplitStokes_nb.html">Stokes problem with fieldsplit preconditioner (PETSc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="uzawa-scipy_nb.html">(Quasi) Stokes equations (Scipy based Uzawa scheme)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="evalues_laplace_nb.html">Eigenvalue problems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="evalues_laplace_nb.html#Eigenvalues-of-the-Neumann-Laplacian">Eigenvalues of the Neumann Laplacian</a></li>
<li class="toctree-l2"><a class="reference internal" href="evalues_laplace_nb.html#Dirichlet-Eigenvalue-problem">Dirichlet Eigenvalue problem</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="crystal_nb.html">Adaptive phase field: crystal growth model</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcf_nb.html">Moving surface grid: flow under mean curvature</a></li>
<li class="toctree-l1"><a class="reference internal" href="laplace-dwr_nb.html">Dual Weighted Reisdual Estimate</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Further Topics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cpp.html">Using C++ Code Snippets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cppfunctions_nb.html">C++ Based Grid Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="lineplot_nb.html">Sampling the Solution over a Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcf-algorithm_nb.html">Mean Curvature Flow (revisited)</a></li>
<li class="toctree-l2"><a class="reference internal" href="laplace-dwr-algorithm_nb.html">Dual Weighted Reisdual Estimate (revisited)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="scheme_api.html">API for schemes and operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#abstract-concepts">Abstract concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-without-dbc">Operator without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-with-dbc">Operator with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-without-dbc">Scheme without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-with-dbc">Scheme with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#additional">Additional</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#unclear">Unclear</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="twophaseflow_descr.html">HP adaptive DG scheme for twophase flow problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Defining-the-model">Defining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Time-discretization">Time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Stabilization-(Limiter)">Stabilization (Limiter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Iterative-schemes-(iterative-or-impes-iterative)">Iterative schemes (iterative or impes-iterative)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#HP-Adpativity">HP Adpativity</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-grid-adaptivity-(h)">Marker for grid adaptivity (h)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-space-adaptivity-(p)">Marker for space adaptivity (p)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Main-program">Main program</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mmesh_descr.html">Mixed-dimensional PDEs: the Dune-MMesh module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="mmesh_nb.html">Dune-MMesh: Solving a Mixed-dimensional PDE</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Information and Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing this project</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">Information for C++ Developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="developers.html#remove-and-rebuild-existing-modules">Remove and rebuild existing modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#using-a-debugger">Using a debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="developers.html#list-of-build-specific-environment-variables">List of build specific environment variables</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributions.html">How to showcase your own project</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional.html">Notebooks and Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional.html#mesh-files-used-in-the-examples">Mesh Files used in the Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog290.html">Since 2.9 release</a><ul>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#deprecation-of-dune-ufl-expression2gf">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.ufl.expression2GF</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-function-integrate">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.function.integrate</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-function-uflfunction-and-dune-fem-function-cppfunction">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.function.uflFunction</span></code> and <code class="docutils literal notranslate"><span class="pre">dune.fem.function.cppFunction</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#id1">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.ufl.expression2GF</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-operator-linear">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.operator.linear</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#deprecation-of-dune-fem-space-combinedspace">Deprecation of <code class="docutils literal notranslate"><span class="pre">dune.fem.space.combinedSpace</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#add-dirichletindices-method-to-operators-and-schemes">Add <code class="docutils literal notranslate"><span class="pre">DirichletIndices</span></code> method to operators and schemes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#extension-of-the-jacobian-method-on-schemes-and-operators">Extension of the <code class="docutils literal notranslate"><span class="pre">jacobian</span></code> method on schemes and operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#set-non-default-quadratures-in-quadrature-rules">Set non default quadratures in quadrature rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#assembly-function">Assembly function</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#improved-pickling-support">Improved Pickling support</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#paraview-reader">Paraview Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#sampler-along-boundary">Sampler along Boundary</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#point-sampler-returning-entity-local-coordinate-for-given-global-coordinate">Point sampler returning (entity,local coordinate) for given global coordinate</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#improved-dirichlet-boundary-indexing-in-ufl-forms">Improved Dirichlet Boundary Indexing in UFL Forms</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#eisenstatwalker-in-newton-method">Eisenstatwalker in Newton method</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#storage-setup-in-scheme">Storage setup in scheme</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#methods-on-space-to-return-local-mapper-and-for-evaluating-basis-functions">Methods on space to return local mapper and for evaluating basis functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="changelog290.html#logging-of-parameter-values">Logging of parameter values</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inforesources.html">Keyword index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gmsh2dgf_nb.html">Converting gmsh to DGF</a></li>
<li class="toctree-l1"><a class="reference internal" href="slurmbatchscript.html">Slurm batch script</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheme_api.html">API for schemes and operators</a><ul>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#abstract-concepts">Abstract concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-without-dbc">Operator without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#operator-with-dbc">Operator with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-without-dbc">Scheme without DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#scheme-with-dbc">Scheme with DBC:</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#additional">Additional</a></li>
<li class="toctree-l2"><a class="reference internal" href="scheme_api.html#unclear">Unclear</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">List of things that need doing…</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DUNE-FEM Tutorial</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Grid views and adaptivity</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><em>Section author: Andreas Dedner &lt;<a class="reference external" href="mailto:a&#46;s&#46;dedner&#37;&#52;&#48;warwick&#46;ac&#46;uk">a<span>&#46;</span>s<span>&#46;</span>dedner<span>&#64;</span>warwick<span>&#46;</span>ac<span>&#46;</span>uk</a>&gt;, Robert Klöfkorn</em></p>
<section id="grid-views-and-adaptivity">
<span id="index-1"></span><span id="index-0"></span><h1>Grid views and adaptivity<a class="headerlink" href="#grid-views-and-adaptivity" title="Link to this heading"></a></h1>
<section id="overview-and-some-basic-grid-views-level-and-filtered">
<h2>Overview and some basic grid views (level and filtered)<a class="headerlink" href="#overview-and-some-basic-grid-views-level-and-filtered" title="Link to this heading"></a></h2>
<p>When constructing a grid, the object returned to Python is always the so
called <code class="docutils literal notranslate"><span class="pre">LeafGridView</span></code>. Without any refinement this is simply a view on all
the elements of the grid. As soon as the grid is refined the leaf grid view changes
so that it always contains the <code class="docutils literal notranslate"><span class="pre">leaf</span></code> elements the grid, i.e., the elements
on the finest level. Since it is a read only view refinement is carried out
using the underlying <code class="docutils literal notranslate"><span class="pre">hierarchical</span> <span class="pre">grid</span></code>, i.e.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span><span class="o">.</span><span class="n">hierarchicalGrid</span><span class="o">.</span><span class="n">globalRefine</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>For a given hierarchical grid one can use different views, i.e., a view on
all the elements of a given level:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">levelView</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">hierarchicalGrid</span><span class="o">.</span><span class="n">levelView</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="toctree-wrapper compound" id="levelgv">
<ul>
<li class="toctree-l1"><a class="reference internal" href="levelgridview_nb.html">LevelGridView examples</a></li>
</ul>
</div>
<p>DUNE-FEM provides a number of additional views which will be discussed
further in this chapter:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dune.fem.view.adaptiveLeafGridView</span></code>: this view should be used when
the grid is supposed to be locally adapted. The view is still on the leaf
elements of the grid but way data is attached to the entities of the grid
is optimized for frequent grid changes as caused by local adaptivity. Its
usage is shown in the following examples.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dune.fem.view.geometryGridView</span></code>: this is an example of a <code class="docutils literal notranslate"><span class="pre">meta</span></code> grid
view which is constructed from an existing grid view and replaces some
aspect - in this case the geometry of each element using a given grid
function. This concept makes it easy to perform simulations for example on
complex domains or on moving grids as shown in <a class="reference internal" href="#geomgv"><span class="std std-ref">Evolving Domains</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dune.fem.view.filteredGridView</span></code>: allows the user to select a subset of
a given grid view by providing a filter on the elements. In its simplest
version only the iterator is replaced with an iterator over the elements
in the filter but in addition it is also possible to obtain a new index
set with indices restricted to the elements in the filter.</p></li>
</ul>
<div class="toctree-wrapper compound" id="filteredgv">
<ul>
<li class="toctree-l1"><a class="reference internal" href="filteredgridview_nb.html">FilteredGridView examples</a></li>
</ul>
</div>
</section>
<section id="dynamic-local-grid-refinement-and-coarsening-h-adaptation">
<h2>Dynamic Local Grid Refinement and Coarsening (h-adaptation)<a class="headerlink" href="#dynamic-local-grid-refinement-and-coarsening-h-adaptation" title="Link to this heading"></a></h2>
<p>For refining and coarsening a grid locally the <code class="docutils literal notranslate"><span class="pre">dune.fem</span></code> module provides a
function <code class="docutils literal notranslate"><span class="pre">gridAdapt</span></code>. The storage of <strong>all</strong> discrete functions will be
automatically resized to accommodate the changes in the hierarchical grid those
are associated with. Please read the entire section carefully.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>The resulting DOF vector will <strong>not be initialized</strong>. To prolong and restrict data
from the old to the new grid, the corresponding discrete functions have to be
passed to the <code class="docutils literal notranslate"><span class="pre">dune.fem.gridAdapt</span></code> method:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fem</span><span class="o">.</span><span class="n">gridAdapt</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">uN</span><span class="p">])</span>
</pre></div>
</div>
<p>This will adapt the grid with the marking of elements for refinement or coarsening
provided by the <code class="docutils literal notranslate"><span class="pre">marker</span></code> which is either an instance of <code class="docutils literal notranslate"><span class="pre">GridMarker</span></code> or a callback (see below).
A call to <cite>fem.gridAdapt</cite> will also re-distribute
the work load in parallel runs. The load balancing can be done separately
by providing an additional argument <cite>loadBalance=False</cite> as described below.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the prolongation/restriction described here <strong>requires</strong> that the
discrete spaces were constructed over an <code class="docutils literal notranslate"><span class="pre">adaptiveLeafGridView</span></code>.</p>
</div>
<p>So the code has to be modified for example as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.alugrid</span> <span class="kn">import</span> <span class="n">aluConformGrid</span> <span class="k">as</span> <span class="n">leafGridView</span>
<span class="kn">from</span> <span class="nn">dune.fem.view</span> <span class="kn">import</span> <span class="n">adaptiveLeafGridView</span> <span class="k">as</span> <span class="n">adaptiveGridView</span>
<span class="n">gridView</span> <span class="o">=</span> <span class="n">adaptiveGridView</span><span class="p">(</span> <span class="n">leafGridView</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>if the underlying storage of a discrete function is stored on the Python
side as a numpy array, i.e., <code class="docutils literal notranslate"><span class="pre">vec</span> <span class="pre">=</span> <span class="pre">uh.as_numpy</span></code> was called, then access
to <code class="docutils literal notranslate"><span class="pre">vec</span></code> will be undefined after a grid modification since the
underlying buffer change will not have been registered.</p>
</div>
<p>The module <code class="docutils literal notranslate"><span class="pre">dune.fem</span></code> provides an object for marking elements for
refinement/coarsening:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.fem</span> <span class="kn">import</span> <span class="n">GridMarker</span>
<span class="n">marker</span> <span class="o">=</span> <span class="n">GridMarker</span><span class="p">(</span> <span class="n">indicator</span><span class="p">,</span> <span class="c1"># grid function to be evaluated at cell center</span>
                     <span class="n">refineTolerance</span><span class="p">,</span> <span class="n">coarsenTolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># tolerances (float or callable returning float)</span>
                     <span class="n">minLevel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxLevel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>    <span class="c1"># min and max level allowed</span>
                     <span class="n">minVolume</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">maxVolume</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="c1"># min and max element volume allowed</span>
                     <span class="n">statistics</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>           <span class="c1"># element counts for marked refined or coarsen</span>
                     <span class="n">strategy</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span>          <span class="c1"># marking strategy: default or doerfler</span>
                     <span class="n">layered</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>               <span class="c1"># parameter for Doerfler layered strategy.</span>
                     <span class="n">markNeighbors</span> <span class="o">=</span> <span class="kc">False</span> <span class="p">)</span>       <span class="c1"># for elements marked for refinement</span>
                                                   <span class="c1"># also mark neighboring elements</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">indicator</span></code> is a piecewise constant grid function.
An element <span class="math notranslate nohighlight">\(E\)</span> is marked for refinement if the value of <code class="docutils literal notranslate"><span class="pre">indicator</span></code>
evaluated at the center of <span class="math notranslate nohighlight">\(E\)</span> is greater than <code class="docutils literal notranslate"><span class="pre">refineTolerance</span></code> and coarsened if the
value is less than <code class="docutils literal notranslate"><span class="pre">coarsenTolerance</span></code>. The element <span class="math notranslate nohighlight">\(E\)</span> is not
refined if its level is already at <code class="docutils literal notranslate"><span class="pre">maxLevel</span></code> and not coarsened if its
level is at <code class="docutils literal notranslate"><span class="pre">minLevel</span></code> and accordingly for the <code class="docutils literal notranslate"><span class="pre">minVolume</span></code> and <code class="docutils literal notranslate"><span class="pre">maxVolume</span></code>.
This method can for example be used to refine the grid according to an equal distribution strategy by
setting <code class="docutils literal notranslate"><span class="pre">refineTolerance=theta/grid.size(0)</span></code> with some tolerance <code class="docutils literal notranslate"><span class="pre">theta</span></code>.
A <strong>layered Doerfler strategy</strong> is also available. Select <code class="docutils literal notranslate"><span class="pre">strategy='doerfler'</span></code>
in the above <code class="docutils literal notranslate"><span class="pre">GridMarker</span></code> object constructor.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For debugging and testing the marking of elements can also be done by
providing a callback to the <code class="docutils literal notranslate"><span class="pre">gridAdapt</span></code> function with the following
signature:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.grid</span> <span class="kn">import</span> <span class="n">Marker</span>
<span class="k">def</span> <span class="nf">marker</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Marker</span>
    <span class="k">if</span> <span class="n">refine</span> <span class="n">E</span><span class="p">:</span> <span class="c1"># if condition for refinement true</span>
        <span class="k">return</span> <span class="n">Marker</span><span class="o">.</span><span class="n">Refine</span>
    <span class="k">elif</span> <span class="n">coarsen</span> <span class="n">E</span><span class="p">:</span> <span class="c1"># if condition for coarsening true</span>
        <span class="k">return</span> <span class="n">Marker</span><span class="o">.</span><span class="n">coarsen</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># otherwise keep E as is (might still be changed)</span>
        <span class="k">return</span> <span class="n">Marker</span><span class="o">.</span><span class="n">keep</span>
</pre></div>
</div>
<p>The module <code class="docutils literal notranslate"><span class="pre">dune.fem</span></code> also provides a <code class="docutils literal notranslate"><span class="pre">globalRefine(level,*dfs)</span></code> method,
where a negative level globally coarsens the grid. If discrete functions
are passed in they will be prolonged (restricted) and resized correctly,
the DOF vectors of all other discrete functions will only be resized, i.e.
stored data will be lost.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The call to <code class="docutils literal notranslate"><span class="pre">gridAdapt</span></code> will also lead to a subsequent call to <code class="docutils literal notranslate"><span class="pre">loadBalance</span></code> for a
re-distribution of work load. This can be prevented by passing the bool flag <code class="docutils literal notranslate"><span class="pre">loadBalance=False</span></code> when calling <code class="docutils literal notranslate"><span class="pre">gridAdapt</span></code>.
The re-distribution can be initiated separately with a call to <code class="docutils literal notranslate"><span class="pre">fem.loadBalance</span></code>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fem</span><span class="o">.</span><span class="n">gridAdapt</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">uN</span><span class="p">],</span> <span class="n">loadBalance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># no load balancing is carried out</span>
<span class="o">...</span>
<span class="n">fem</span><span class="o">.</span><span class="n">loadBalance</span><span class="p">(</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">uN</span><span class="p">]</span> <span class="p">)</span> <span class="c1"># re-distribute work load (maybe less frequent than gridAdapt)</span>
</pre></div>
</div>
<p>The following two examples showcase adaptivity: the first one using a
residual a-posteriori estimator for an elliptic problem, the second one
shows adaptivity for a time dependent phase field model for crystal growth.
At the end of this section a dual weighted residual approach is used to
optimize the grid with respect to the error at a given point.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="laplace-adaptive_nb.html">Re-entrant Corner Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="crystal_nb.html">Adaptive phase field: crystal growth model</a></li>
</ul>
</div>
<p>While these
examples can be implemented completely using the available Python
bindings it is also fairly easy to implement a custom marking strategy in C++ and mark the grid before <code class="docutils literal notranslate"><span class="pre">gridAdapt</span></code> is called.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.generator</span> <span class="kn">import</span> <span class="n">algorithm</span>
<span class="n">algorithm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;mymarking.hh&#39;</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="n">uN</span> <span class="p">)</span>

<span class="c1"># pass None for marker to avoid further marking</span>
<span class="n">fem</span><span class="o">.</span><span class="n">gridAdapt</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">uN</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="overview-on-adaptivity-for-spaces-p-adaptation">
<h2>Overview on adaptivity for spaces (p-adaptation)<a class="headerlink" href="#overview-on-adaptivity-for-spaces-p-adaptation" title="Link to this heading"></a></h2>
<p>For adjusting the polynomial degree of a discrete function space locally (on each element separately)
the <code class="docutils literal notranslate"><span class="pre">dune.fem</span></code> module provides a function <code class="docutils literal notranslate"><span class="pre">spaceAdapt</span></code>. The storage of <strong>all</strong> discrete functions created over this space
will be automatically resized to accommodate the changes in the space that is adapted.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Unlike for grid adaptation the <strong>space adaptation</strong> has to be carried out <strong>for each space separately</strong>.
To correctly transfer data the corresponding discrete functions have to be
passed to the <code class="docutils literal notranslate"><span class="pre">dune.fem.spaceAdapt</span></code> method:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fem</span><span class="o">.</span><span class="n">spaceAdapt</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="p">[</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="o">...</span><span class="p">,</span><span class="n">uN</span><span class="p">])</span> <span class="c1"># marker is explained below</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All the prolongation/restriction described here <strong>requires</strong> that the
discrete spaces were constructed over an <code class="docutils literal notranslate"><span class="pre">adaptiveLeafGridView</span></code>.</p>
<p>Furthermore, the discrete space used has to <strong>support p-adaptation</strong>, which is
only the case for a handful of space. This can be checked with
<code class="docutils literal notranslate"><span class="pre">space.canAdapt</span></code>, which is true if the space supports p-adaptation.
Spaces that support <strong>hp</strong> adaptation typically have a <strong>hp</strong> in the name, e.g <code class="docutils literal notranslate"><span class="pre">lagrangehp</span></code>.</p>
</div>
<p>So the code has to be modified for example as follows</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.alugrid</span> <span class="kn">import</span> <span class="n">aluConformGrid</span> <span class="k">as</span> <span class="n">leafGridView</span>
<span class="kn">from</span> <span class="nn">dune.fem.view</span> <span class="kn">import</span> <span class="n">adaptiveLeafGridView</span> <span class="k">as</span> <span class="n">adaptiveGridView</span>
<span class="n">gridView</span> <span class="o">=</span> <span class="n">adaptiveGridView</span><span class="p">(</span> <span class="n">leafGridView</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>if the underlying storage of a discrete function is stored on the Python
side as a numpy array, i.e., <code class="docutils literal notranslate"><span class="pre">vec</span> <span class="pre">=</span> <span class="pre">uh.as_numpy</span></code> was called, then access
to <code class="docutils literal notranslate"><span class="pre">vec</span></code> will be undefined after a grid modification since the
underlying buffer change will not have been registered.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The marking of the local polynomial degree of a discrete space is provided the by <code class="docutils literal notranslate"><span class="pre">marker</span></code> which
is either an instance of <code class="docutils literal notranslate"><span class="pre">SpaceMarker</span></code> or a callback (see below).</p>
</div>
<p>The module <code class="docutils literal notranslate"><span class="pre">dune.fem</span></code> provides an object for marking spaces for
p-refinement/p-coarsening:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.fem</span> <span class="kn">import</span> <span class="n">SpaceMarker</span>
<span class="n">marker</span> <span class="o">=</span> <span class="n">SpaceMarker</span><span class="p">(</span> <span class="n">indicator</span><span class="p">,</span> <span class="c1"># grid function to be evaluated at cell center</span>
                      <span class="n">refineTolerance</span><span class="p">,</span> <span class="n">coarsenTolerance</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c1"># tolerances (float or callable returning float)</span>
                      <span class="n">minOrder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># minimal order to be assumed (in [0, space.order)</span>
                      <span class="n">maxOrder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># maximal order to be assumed (in [minOrder, space.order]). -1 defaults to space.order</span>
                      <span class="n">markNeighbors</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># for elements marked for increase also mark neighboring elements</span>
                      <span class="n">statistics</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>    <span class="c1"># element counts for marked refined or coarsen</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">indicator</span></code> is a piecewise constant grid function.
The polynomial degree <span class="math notranslate nohighlight">\(p\)</span> of a space for an element <span class="math notranslate nohighlight">\(E\)</span> is increased by <span class="math notranslate nohighlight">\(1\)</span>
if the value of <code class="docutils literal notranslate"><span class="pre">indicator</span></code> evaluated at the center of <span class="math notranslate nohighlight">\(E\)</span> is greater than <code class="docutils literal notranslate"><span class="pre">refineTolerance</span></code> and decreased by <span class="math notranslate nohighlight">\(1\)</span>
if the value is less than <code class="docutils literal notranslate"><span class="pre">coarsenTolerance</span></code>. The polynomial degree for <span class="math notranslate nohighlight">\(E\)</span> is not changed if the result would be outside of the interval <span class="math notranslate nohighlight">\([\)</span> <code class="docutils literal notranslate"><span class="pre">minOrder</span></code>, <code class="docutils literal notranslate"><span class="pre">maxOrder</span></code> <span class="math notranslate nohighlight">\(]\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For debugging and testing the marking of elements can also be done by
providing a callback to the <code class="docutils literal notranslate"><span class="pre">spaceAdapt</span></code> function with the following
signature:</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">marker</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
    <span class="c1"># current polynomial degree for E</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">space</span><span class="o">.</span><span class="n">localOrder</span><span class="p">(</span> <span class="n">E</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">increase</span> <span class="n">degree</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="n">maxOrder</span><span class="p">:</span> <span class="c1"># if condition for refinement</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">elif</span> <span class="n">decrease</span> <span class="n">degree</span> <span class="ow">and</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="n">minOrder</span><span class="p">:</span> <span class="c1"># if condition for coarsening</span>
        <span class="k">return</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># otherwise keep current degree</span>
        <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
<p>An example where p-adaptation is used can be found here:</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="twophaseflow_descr.html">HP adaptive DG scheme for twophase flow problem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html">Problem Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Defining-the-model">Defining the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Time-discretization">Time discretization</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Stabilization-(Limiter)">Stabilization (Limiter)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Iterative-schemes-(iterative-or-impes-iterative)">Iterative schemes (iterative or impes-iterative)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#HP-Adpativity">HP Adpativity</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-grid-adaptivity-(h)">Marker for grid adaptivity (h)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Marker-for-space-adaptivity-(p)">Marker for space adaptivity (p)</a></li>
<li class="toctree-l2"><a class="reference internal" href="twophaseflow_nb.html#Main-program">Main program</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="overview-on-moving-grids-r-adaptation">
<h2>Overview on moving grids (r-adaptation)<a class="headerlink" href="#overview-on-moving-grids-r-adaptation" title="Link to this heading"></a></h2>
<p>An example of <cite>r-adaptation</cite> for a two-phase flow problem in porous media is found
on the <a class="reference external" href="https://dune-mmesh.readthedocs.io/en/latest/examples/moving.html">Dune-MMesh</a> documentation page.</p>
<p>As mentioned above DUNE-FEM provides a grid view that makes it easy to
exchange the geometry of each entity in the grid. To setup such a grid view
one first needs to construct a standard grid view, i.e., a <code class="docutils literal notranslate"><span class="pre">leafGridView</span></code>
and define a grid function over this view using for example a discrete
function, a UFL function, or one of the concepts described in the section
<a class="reference internal" href="concepts_nb.html#Grid-Functions"><span class="std std-ref">Grid Function</span></a>.
Note that the topology of the
grid does not change, i.e., how entities are connected with each other.
The following shows an example of how to change a grid of the unit square
into a grid of a diamond shape:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">SpatialCoordinate</span><span class="p">,</span> <span class="n">triangle</span><span class="p">,</span> <span class="n">as_vector</span>
<span class="kn">from</span> <span class="nn">dune.grid</span> <span class="kn">import</span> <span class="n">structuredGrid</span>
<span class="kn">from</span> <span class="nn">dune.fem.view</span> <span class="kn">import</span> <span class="n">geometryGridView</span>
<span class="kn">from</span> <span class="nn">dune.fem.function</span> <span class="kn">import</span> <span class="n">gridFunction</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">structuredGrid</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">as_vector</span><span class="p">([</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">])</span>
<span class="n">diamond</span> <span class="o">=</span> <span class="n">gridFunction</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span><span class="n">square</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;diamond&quot;</span><span class="p">)</span>
<span class="n">diamond</span> <span class="o">=</span> <span class="n">geometryGridView</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diamond</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/geoview_nb_2_01.jpg" src="_images/geoview_nb_2_01.jpg" />
<p>In a second example we embed a 1D interval into 3D:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ufl</span> <span class="kn">import</span> <span class="n">interval</span><span class="p">,</span><span class="n">cos</span><span class="p">,</span><span class="n">sin</span>
<span class="n">square</span> <span class="o">=</span> <span class="n">structuredGrid</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="mi">25</span><span class="p">],[</span><span class="mi">100</span><span class="p">])</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">SpatialCoordinate</span><span class="p">(</span><span class="n">interval</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">as_vector</span><span class="p">([</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)])</span><span class="o">*</span><span class="p">(</span><span class="mi">25</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span>
<span class="n">diamond</span> <span class="o">=</span> <span class="n">gridFunction</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span><span class="n">square</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;diamond&quot;</span><span class="p">)</span>
<span class="n">spiral</span> <span class="o">=</span> <span class="n">geometryGridView</span><span class="p">(</span><span class="n">diamond</span><span class="p">)</span>
</pre></div>
</div>
<p>Note: currently plotting for 1d grids is not implemented spiral.plot()
but we can plot some grid function, e.g., given by ufl expressions</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dune.fem.plotting</span> <span class="kn">import</span> <span class="n">plotPointData</span> <span class="k">as</span> <span class="n">plot</span>
<span class="n">plot</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">gridView</span><span class="o">=</span><span class="n">spiral</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/geoview_nb_6_01.jpg" src="_images/geoview_nb_6_01.jpg" />
<p>By using a discrete function to construct a geometry grid view, it becomes
possible to simulate problems on evolving domains where the evolution is
itself the solution of the partial differential equation. We demonstrate
this approach based on the example of surface mean curvature flow first in
its simplest setting and then with the evolution of the surface depending
on values of a computed surface quantity satisfying a heat equation on the
surface:</p>
<p>Further examples using moving meshes:</p>
<div class="toctree-wrapper compound" id="geomgv">
<ul>
<li class="toctree-l1"><a class="reference internal" href="mcf_nb.html">Moving surface grid: flow under mean curvature</a></li>
<li class="toctree-l1"><a class="reference internal" href="elasticity_nb.html">Linear Elasticity: a deformed beam</a></li>
</ul>
</div>
<a class="reference external image-reference" href="https://doi.org/10.5281/zenodo.3706994"><img alt="https://zenodo.org/badge/DOI/10.5281/zenodo.3706994.svg" src="https://zenodo.org/badge/DOI/10.5281/zenodo.3706994.svg" />
</a>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2025, Andreas Dedner and Robert Klöfkorn.
      <span class="lastupdated">Last updated on Nov 28, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>